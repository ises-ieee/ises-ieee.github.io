<header class="site-header">
  <div class="container header-inner">
    {# ✅ Step-2 fix: use Eleventy `url` filter so `pathPrefix` is applied automatically #}
    <a class="brand" href="{{ '/index.html' | url }}" aria-label="Home">
      <img src="{{ '/images/ieee-ises_logo_2026.png' | url }}" alt="IEEE-iSES logo">
      <div class="brand-title">
        <div class="name">{{ site.confName }} {{ site.year }}</div>
        <div class="tag">{{ site.tagline }}</div>
      </div>
    </a>

    <button class="nav-toggle" type="button" data-nav-toggle aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button>

    {# Recursive nav renderer #}
    {% macro render_items(items) %}
      {% for item in items %}
        <li>
          {# ✅ Step-2 fix: run ALL internal links through `| url` (and keep external/mailto/# untouched) #}
          {% set raw = item.url or '#' %}
          {% set href = raw %}

          {% if raw != '#'
            and not raw.startsWith('http')
            and not raw.startsWith('mailto:')
            and not raw.startsWith('#')
          %}
            {# raw is like "/call-for-contributions.html" #}
            {% set href = raw | url %}
          {% endif %}

          <a href="{{ href }}">{{ item.label }}</a>

          {# Dynamic submenu: Past Conferences #}
          {% if item.dynamic == "pastConferences" %}
            <ul>
              {% for conf in pastConferences.items %}
                {% set cRaw = conf.url %}
                {% set cHref = cRaw %}

                {% if cRaw
                  and not cRaw.startsWith('http')
                  and not cRaw.startsWith('mailto:')
                  and not cRaw.startsWith('#')
                %}
                  {% set cHref = cRaw | url %}
                {% endif %}

                <li><a href="{{ cHref }}">{{ conf.name }}</a></li>
              {% endfor %}
            </ul>
          {% elif item.children and item.children.length %}
            <ul>
              {{ render_items(item.children) }}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    {% endmacro %}

    <nav class="site-nav" data-nav data-open="false" aria-label="Primary">
      <ul>
        {{ render_items(nav) }}
      </ul>
    </nav>
  </div>
</header>
